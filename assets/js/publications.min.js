(function(){const ICON_SVG='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.83a2 2 0 0 0-.59-1.41l-4.83-4.83A2 2 0 0 0 12.17 2H7zm5 2 5 5h-3a2 2 0 0 1-2-2V4zM9 11h6v2H9v-2zm0 4h6v2H9v-2z"/></svg>';const COPY={es:{other:'Sin año',count:(value)=>`${value}${value===1?'publicación':'publicaciones'}`},ca:{other:'Sense any',count:(value)=>`${value}${value===1?'publicació':'publicacions'}`},en:{other:'Undated',count:(value)=>`${value}${value===1?'publication':'publications'}`}};function createIcon(){const wrapper=document.createElement('span');wrapper.className='publication-icon';wrapper.setAttribute('aria-hidden','true');wrapper.innerHTML=ICON_SVG;return wrapper;}
function normaliseLocale(raw){if(!raw)return'es';return raw.toLowerCase().split('-')[0];}
function parsePublications(container){const items=Array.from(container.querySelectorAll('.mb-md'));return items.map((block)=>{const numberText=block.querySelector('.text-bold');const body=block.querySelector('.mb-lg');if(!numberText||!body){return null;}
const number=parseInt(numberText.textContent.replace('.','').trim(),10);const html=body.innerHTML.trim();const plain=body.textContent.trim();const yearMatch=plain.match(/\b(19|20)\d{2}\b/);return{number:Number.isNaN(number)?null:number,html,year:yearMatch?parseInt(yearMatch[0],10):null};}).filter(Boolean);}
function buildCard(item){const article=document.createElement('article');article.className='publication-card';const marker=document.createElement('div');marker.className='publication-card__marker';marker.appendChild(createIcon());if(item.number!==null){const numberElement=document.createElement('span');numberElement.className='publication-number';numberElement.textContent=item.number;marker.appendChild(numberElement);}
if(item.year){const yearElement=document.createElement('span');yearElement.className='publication-year';yearElement.textContent=item.year;marker.appendChild(yearElement);}
const body=document.createElement('div');body.className='publication-card__body';body.innerHTML=item.html;article.append(marker,body);return article;}
function buildAccordionItem(item){const li=document.createElement('li');li.className='publication-accordion__item';li.appendChild(createIcon());if(item.number!==null){const number=document.createElement('span');number.className='publication-accordion__number';number.textContent=item.number;li.appendChild(number);}
const body=document.createElement('div');body.className='publication-accordion__body';body.innerHTML=item.html;li.appendChild(body);return li;}
function initPublications(container){const locale=normaliseLocale(document.documentElement.lang);const copy=COPY[locale]||COPY.es;const controls=container.parentElement.querySelectorAll('[data-publication-controls] [data-publication-view]');const data=parsePublications(container);if(!data.length){return;}
container.innerHTML='';let currentView='cards';const removeViewClasses=()=>{container.classList.remove('publications-render--cards','publications-render--grid','publications-render--accordion');};const setActiveButton=(view)=>{controls.forEach((button)=>{const isActive=button.getAttribute('data-publication-view')===view;button.classList.toggle('is-active',isActive);button.setAttribute('aria-pressed',isActive?'true':'false');});};const renderCards=()=>{removeViewClasses();container.classList.add('publications-render','publications-render--cards');container.innerHTML='';data.forEach((item)=>{container.appendChild(buildCard(item));});};const renderGrid=()=>{removeViewClasses();container.classList.add('publications-render','publications-render--grid');container.innerHTML='';data.forEach((item)=>{const card=buildCard(item);container.appendChild(card);});};const renderAccordion=()=>{removeViewClasses();container.classList.add('publications-render','publications-render--accordion');container.innerHTML='';const groups=new Map();data.forEach((item)=>{const key=item.year||'other';if(!groups.has(key)){groups.set(key,[]);}
groups.get(key).push(item);});const keys=Array.from(groups.keys()).sort((a,b)=>{if(a==='other')return 1;if(b==='other')return-1;return Number(b)-Number(a);});keys.forEach((key,index)=>{const details=document.createElement('details');details.className='publication-accordion';if(index===0){details.open=true;}
const summary=document.createElement('summary');const label=key==='other'?copy.other:key;const count=groups.get(key).length;summary.innerHTML=`<span>${label}</span><span class="publication-accordion__count">${copy.count(count)}</span>`;details.appendChild(summary);const list=document.createElement('ul');list.className='publication-accordion__list';groups.get(key).forEach((item)=>{list.appendChild(buildAccordionItem(item));});details.appendChild(list);container.appendChild(details);});};const renderers={cards:renderCards,grid:renderGrid,accordion:renderAccordion};const setView=(view)=>{const safeView=renderers[view]?view:'cards';currentView=safeView;setActiveButton(safeView);renderers[safeView]();};controls.forEach((button)=>{button.addEventListener('click',()=>{const target=button.getAttribute('data-publication-view');if(target&&target!==currentView){setView(target);}});});setView(currentView);}
document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('[data-publications]').forEach((container)=>{initPublications(container);});});})();